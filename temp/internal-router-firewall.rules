#Anything that is not specifically allowed has to be denied.
iptables -P INPUT DROP
iptables -P OUTPUT DROP
iptables -P FORWARD DROP

#All the hosts have to use as DNS resolver the internal DNS.
iptables -A FORWARD -p tcp -o "interface" -d "IP of DC" --dport 53  -m state --state NEW,ESTABLISHED,RELATED -j ACCEPT
iptables -A FORWARD -p tcp -i "interface" -s "IP of DC" --sport 53  -m state --state ESTABLISHED,RELATED -j ACCEPT

#Only the webserver service provided in the DMZ has to be accessible from the Internet.



#The proxy service provided in the DMZ has to be accessible only from the hosts of the Acme network. 
#However, the proxy needs internet access (see below, section Services of the ACME co.)

iptables -A FORWARD -p tcp -o "interface" -d "IP of DC" --dport 53  -m state --state NEW,ESTABLISHED,RELATED -j ACCEPT
iptables -A FORWARD -p tcp -i "interface" -s "IP of DC" --sport 53  -m state --state ESTABLISHED,RELATED -j ACCEPT

#All the services provided by hosts in the Internal server network 
#have to be accessible only by Client network and DMZ hosts.

iptables -A FORWARD -p UDP -o "interface" -d "IP of Logserver" --dport 514  -m state --state NEW,ESTABLISHED,RELATED -j ACCEPT
iptables -A FORWARD -p UDP -i "interface" -s "IP of Logserver" --sport 514  -m state --state ESTABLISHED,RELATED -j ACCEPT







#All the hosts (but the Client network hosts) have to use the syslog service on the Log server (syslog).



#All the hosts of the network have to be managed via ssh only from hosts within the Client network.



#All the Client network hosts have to only access external web services (http/https).





#Services

#A web service in the standard port (in Web Server host)
#TCP = 80

#A DNS in the standard port (in Domain Controller host)
#TCP = 53

#A syslog server in the UDP standard port (in Log Server host)
#UDP = 514 

#A proxy server that can be used by the hosts of the ACME network to request connections via HTTP or HTTPS to external hosts.
#TCP = 3128, 8000 and 8080. 